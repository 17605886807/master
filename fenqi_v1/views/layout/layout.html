<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="author" content="lock">
    <meta name="keywords" content="现金分期">
    <meta name="description" content="现金分期">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- <link href="../../static/css/bootstrap.min.css" rel="stylesheet"> -->
    <link href="../../static/css/font-awesome.min.css" rel="stylesheet" type="text/css" />
    <link href="../../static/css/layout.css" rel="stylesheet">
    <link href="../../static/css/index.css" rel="stylesheet">
    <link href="../../static/css/style-responsive.css" rel="stylesheet">
    <link href="../../static/css/box.css" rel="stylesheet">
    <link href="../../static/css/daterangepicker.css" rel="stylesheet">
    <link rel="stylesheet" href="../../static/css/city-picker.css"><!-- 城市选择空间样式 -->
    
    <link href="../../static/css/order_detail.css" rel="stylesheet"><!-- 信审工作台页面样式 -->
    <link href="../../static/css/magnify.css" rel="stylesheet"> <!-- 图片局部放大样式 -->

    <script src="../../static/js/jquery-1.9.0.min.js" type="text/javascript"></script>
    <script src="../../static/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../static/js/jquery-ui-1.10.3.min.js" type="text/javascript"></script>
    <script src="../../static/js/history.js" type="text/javascript"></script>
    <script src="../../static/js/dialog.js"></script>
    <script language="JavaScript" for="objocx" event="CallByApplet(value)" src="../../static/js/phone.js"></script>
    <script src="../../static/js/callFunction.js" type="text/javascript"></script>

    
    <script src='../../static/js/city-picker.data.js'></script>
    <script src='../../static/js/city-picker.js'></script>
    <script src="../../static/js/common.js"></script>
    <!-- <script src="../../static/js/underscore-min.js"></script>  -->
    <script src="../../static/js/WdatePicker.js" type="text/javascript"></script>
    <script src="../../static/js/moment.min.js"></script>
    <script src="../../static/js/jquery.daterangepicker.js"></script>
    <script src="../../static/js/layout.js"></script>
    <script src="../../static/js/page.js" type="text/javascript"></script>
    <script src="../../static/js/magnify.js"></script><!-- 图片局部放大js -->
    <script src="../../static/js/permissions.js"></script><!-- 按钮权限控制js -->
    
    <script src="../../static/js/jquery.fixedheadertable.min.js"></script>
    <script type="text/javascript" src="../../static/js/zTree/jquery.ztree.core.js"></script>
    <script type="text/javascript" src="../../static/js/zTree/jquery.ztree.excheck.js"></script>
    <script type="text/javascript" src="../../static/js/base64.js"></script>

    <link class="docs" href="../../static/css/zTreeStyle/zTreeStyle.css" rel="stylesheet" />

    <script src="../static/js/echarts.js"></script>

    <!-- 高德地图所需控件 -->
    <link rel="stylesheet" href="https://cache.amap.com/lbs/static/main1119.css"/>
    <script src="https://cache.amap.com/lbs/static/es5.min.js"></script>
    <script src="https://webapi.amap.com/maps?v=1.4.2&key=8ab6597266f36131eb93aad911f73d27"></script>
    <!-- <script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script> -->

    <!-- <script src="../../static/MyPlayer/MyPlayer.js" ></script> -->

    <title>现金分期</title>
</head>

<body class="sticky-header">
    <div class="left-side sticky-left-side">
        <!-- logo and iconic logo start -->
        <a href="/" style='display:block;text-align:center;'>
            <img src="../../static/img/sideLogo.png" alt="现金分期" width="100px" height="30px" style="margin:20px 0 0 0px;" />
        </a>
        <!-- logo and iconic logo end -->
        <div class="left-side-inner">
            <!-- sidebar nav start -->
            <ul class="nav nav-pills nav-stacked custom-nav js-left-nav">
            </ul>
            <!-- sidebar nav end -->
        </div>
    </div>



    <div class="main-content">
        <div class="header-section">
            <a class="toggle-btn">
                <i class="header_icon_left"></i>
            </a>
            <div class='clickToLogin' style='display:none'>一键登录</div>
            <OBJECT id="UsbossViewer" name="objocx" classid="clsid:6F82C754-6C31-43EA-9818-E95AD4E872FC" width="100px" height="53" style="">
                <PARAM NAME="restrictedAgent" VALUE="0"/>
            </OBJECT>
            <input type="text" name='fadeusername' style='display:none;'>
            <input type="hidden" name='fadepwd' style='display:none;'>
            <div class="menu-right">
                <ul class="notification-menu nt-menu">
                    <li>
                        <a style="width: 134px;height: 48px;" id="slidedown_btn" href="javascript:;" class="btn btn-default dropdown-toggle"
                            data-toggle="dropdown">
                            <img src="../../static/img/img_01.png" alt="libai" />{{.DisplayName}}
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li style="cursor: pointer;">
                                <a onclick="ModifyPwdShow()">
                                    <i class="fa fa-cog"></i> 更换密码</a>
                            </li>
                            <li style="cursor: pointer;">
                                <a href="/loginout">
                                    <i class="fa fa-sign-out"></i> 退出</a>
                            </li>
                        </ul>
                    </li>

                </ul>
            </div>
            <div class="menu-right-left dropdown">
                <ul class="notification-menu nt-menu">
                    <li>
                        <a style="width: 134px;height: 48px;" id="slidedown_btn_line" href="javascript:;" class="btn btn-default dropdown-toggle"
                            data-toggle="dropdown">
                            {{if eq .LoginState "ONLINE"}}在线{{else if eq .LoginState "OFFLINE"}}离线{{end}}
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li style="cursor: pointer;">
                                <a id='changeState'> {{if eq .LoginState "ONLINE"}}离线{{else if eq .LoginState "OFFLINE"}}在线{{end}}</a>
                            </li>
                        </ul>
                    </li>

                </ul>
            </div>
            <div style='clear:both;'></div>
            <div id='qingniu_Mes' style='position: fixed;top: 190px;left: 50%;transform: translateX(-50%)'>
                <TEXTAREA id=Rt cols=130 style="height: 168px;width: 500px;border: 2px solid #599ef4;border-radius: 5px;display: none"></TEXTAREA>
            </div>
        </div>
        <div class="wrapper pr" id="wrapper_c">
            {{.LayoutContent}}
        </div>
    </div>



    <div class="dialog-modifypwd hide1" id="dialog-modifypwd" title="修改密码">
        <div class="col-md-12">
            <div class="panel">
                <div class="panel-body">
                    <ul class="p-info">
                        <li class="col-md-12">
                            <div class="col-md-4">用户名：</div>
                            <div class="col-md-4">{{.DisplayName}}</div>
                        </li>
                        <li class="col-md-12">
                            <div class="col-md-4">原密码：</div>
                            <div class="col-md-4">
                                <input type="password" placeholder="请填写原密码" maxlength="25" id="orgpwd" value="" name="orgpwd"
                                />
                            </div>
                        </li>
                        <li class="col-md-12">
                            <div class="col-md-4">新密码：</div>
                            <div class="col-md-4">
                                <input type="password" placeholder="请填写新密码" maxlength="25" id="newpwd" value="" name="newpwd"
                                />
                            </div>
                        </li>
                        <li class="col-md-12">
                            <div class="col-md-4">确认密码：</div>
                            <div class="col-md-4">
                                <input type="password" placeholder="请再次填写新密码" maxlength="25" id="newpwd2" value="" name="newpwd2"
                                />
                            </div>
                        </li>
                        <li class="col-md-12">
                            <div class="col-md-4"></div>
                            <div class="col-md-8">
                                <a class="btn btn-green" onclick="ModifyPwd()">确定</a>
                                <span class="c_red col-md-16 error" style="float:right;display: block;"></span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        var OCXaid = {{.QnAccount}},OCXapwd={{.QnPassword}},OCXadn = {{.QnAccount}},OCXeid="0101290166";
        // var OCXaid = "25794956", OCXapwd = "25794956", OCXadn = "25794956", OCXeid = "0101290166";
        var OutPutPhone = {{.OutPutPhone}};
        var systemId = {{.Id}};
        function closePopup(ele) {
            ele.addClass("hide1");
        }
        function ModifyPwdShow() {
            $("#dialog-modifypwd").dialog("open");
        }
        // 联系历史修改
        $('#dialog-modifypwd').dialog({
            autoOpen: false,
            modal: true,
            width: 500,
            maxHeight: 500,
            position: ["center", 100]
        });


        function ModifyPwd() {
            var orgpwd = $("#orgpwd").val();
            var newpwd = $("#newpwd").val();
            var newpwd2 = $("#newpwd2").val();
            if (orgpwd == "" || newpwd2 == "" || newpwd == "") {
                $(".dialog-modifypwd .error").html("请正确填写密码!");
            } else if (orgpwd == newpwd) {
                $(".dialog-modifypwd .error").html("新旧密码不能相同!");
            } else if (newpwd !== newpwd2) {
                $(".dialog-modifypwd .error").html("新密码与确认密码不一致!");
            } else {
                $.zpost("/users/modifypassword", { orgpwd: orgpwd, newpwd: newpwd, newpwd2: newpwd2 }, function (result) {
                    if (!!result && result.ret == 200) {
                        alert("密码修改成功!");
                        window.location.href = "/loginout";
                    } else {
                        $(".dialog-modifypwd .error").html(result.error);
                    }
                });
            }
        }

        
        function changeOnline(){
            var state = "ONLINE";
            var uid = {{IdUidEncrypt .Id}};
            var data = {
                uid : uid,
                login_state : state
            }
            $.zget("/system/updatesysuserloginstate",data,function(rslt){
                if(rslt.ret == 200){
                    countdownanimation(3,"上班啦",function(){
                        location.href=""
                    });
                }else {
                    alert(rslt.error); 
                }
            })
        }
        function changeOffline(){
            var state = "OFFLINE";
            var uid = {{IdUidEncrypt .Id}};
            var data = {
                uid : uid,
                login_state : state
            }
            $.zget("/system/updatesysuserloginstate",data,function(rslt){
                if(rslt.ret == 200){
                    countdownanimation(3,"离线啦",function(){
                        location.href=""
                    });
                }else {
                    alert(rslt.error);
                }
            })
        }
        $(function () {
            var OutPutPhone_arr = [];
            for (var i = 0; i < OutPutPhone.split(",").length; i++) {
                var item = OutPutPhone.split(",")[i];
                OutPutPhone_arr.push(item);
            }
            $("#UsbossViewer").css("visibility","hidden");
            if (OCXaid  && OCXapwd  && OCXaid  && OCXapwd ) {
                $(".clickToLogin").show().click(function () {
                    LoginORLogout(OCXaid, OCXapwd, OCXadn, OCXeid)
                });
                $("body").on("click",".clickToCall",function (e) {
                    e.preventDefault();
                    clearInterval(callingTimer);
                    callingSeconds = 0
                    if(!isLogged){
                        alert("请先登录青牛系统");
                        return;
                    }
                    var telephone = $(this).data("telephone")
                    var text = $(this).text();
                    $(".clickToCall").removeClass("calling");
                    $(this).addClass("calling");
                    if(text == "拨号"){
                        var outPhone = OutPutPhone_arr[Math.floor(Math.random()*(OutPutPhone_arr.length))]
                        ANICall("tel:"+telephone, "tel:"+outPhone)
//                        ANICall("tel:"+telephone, "tel:057187956751")
                        // ANICall("tel:18671163683", "tel:"+outPhone);
                    }else if(text == "挂断"){
                        DoHangup();
                    }
                });
            } else {
                $(".clickToLogin").hide();
            }
            $('.toggle-btn').click(function(){
                history.go(-1);
            });
            $("#slidedown_btn").click(function () {
                var dropdown_box = $(".dropdown-menu").eq(0);
                if (dropdown_box.css("display") == "none") {
                    dropdown_box.slideDown();
                } else {
                    dropdown_box.slideUp();
                }
            });
            $("#slidedown_btn_line").click(function () {
                var dropdown_box = $(".dropdown-menu").eq(1);
                if (dropdown_box.css("display") == "none") {
                    dropdown_box.slideDown();
                } else {
                    dropdown_box.slideUp();
                }
            });
            $('#wrapper_c').off().click(function () {
                var dropdown_box = $(".dropdown-menu");
                dropdown_box.slideUp();
            });
            $("#changeState").click(function(){
                var loginState = {{.LoginState}}
                var state = loginState == "ONLINE"?"OFFLINE":"ONLINE";
                var uid = {{IdUidEncrypt .Id}};
                var data = {
                    uid : uid,
                    login_state : state
                }
                $.zget("/system/updatesysuserloginstate",data,function(rslt){
                    if(rslt.ret == 200){
                        if(data.login_state == "ONLINE"){
                            countdownanimation(3,"上班啦",function(){
                                location.href=""
                            });
                        }else{
                            location.href="";
                        }
                        
                    }else {
                        alert(rslt.error);
                    }
                })
            })
        });

    </script>
</body>

</html>